<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:tr="http://myfaces.apache.org/trinidad"
                xmlns:trh="http://myfaces.apache.org/trinidad/html"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:ebi="http://ebi.ac.uk/faces/components"
                xmlns:ebisf="http://www.ebi.ac.uk/faces/site">

  <tr:document title="${config.title}">

         <trh:head>

            <meta http-equiv="Content-Type"
                  content="text/html; charset=UTF-8"/>


            <!-- IntAct dynamic application should not be indexed by search engines -->
            <meta name='robots' content='nofollow'/>

            <link rel="stylesheet" href="#{ebisf:absoluteEbiUrl()}/inc/css/contents.css" type="text/css"/>
            <link rel="stylesheet" href="#{ebisf:absoluteEbiUrl()}/inc/css/userstyles.css" type="text/css"/>
            <link rel="stylesheet" href="#{ebisf:absoluteEbiUrl()}/inc/css/sidebars.css" type="text/css"/>

            <trh:script source="#{ebisf:absoluteEbiUrl()}/inc/js/contents.js" type="text/javascript"/>

             <script type="text/javascript"
                src="http://o.aolcdn.com/dojo/1.0.0/dojo/dojo.xd.js"></script>

             <trh:script source="/js/intact.js"/>

        </trh:head>
      
      <c:set var="defaultBackImage" value="background-image: url('#{ebisf:absoluteContextPath()}/images/top_background.jpg')"/>
      <c:set var="userBackImage" value="background-image: url('#{config.bannerBackgroundUrl}')"/>
      <c:set var="backImage" value="#{empty config.bannerBackgroundUrl ? defaultBackImage : userBackImage}; background-repeat: repeat-x"/>

      <trh:body>
          <trh:tableLayout width="100%"
                            inlineStyle="#{config.bannerBackgroundUrl != null? backImage : ''}">
               <trh:rowLayout>
                   <trh:cellFormat inlineStyle="width:2%" >
                       <tr:image source="#{config.logoUrl}" rendered="#{not empty config.logoUrl}"/>
                   </trh:cellFormat>
                   <trh:cellFormat inlineStyle="vertical-align: bottom" rendered="#{not empty config.title}">
                       <h1>#{config.title}</h1>
                   </trh:cellFormat>

               </trh:rowLayout>
           </trh:tableLayout>

          <div style="padding-left:10px; padding-right: 10px">
              <tr:form>

           <!-- To avoid expired sessions, poll every 15 mins -->
           <tr:poll interval="#{15*60*1000}"/>

           <tr:statusIndicator id="status">
               <f:facet name="busy">
                   <tr:panelGroupLayout layout="horizontal">
                       <tr:image source="/skins/ebi/images/status_busy_redback.gif"
                                 inlineStyle="vertical-align:middle"/>
                       <tr:outputFormatted value="&#160;"/>
                       <tr:outputText value="Loading..."/>
                   </tr:panelGroupLayout>
               </f:facet>
           </tr:statusIndicator>

          <br/>

           <ui:include src="/pages/search/search_panel.xhtml"  />

           <div style="text-align:right; width:100%; margin-top: -20px; position:absolute;">
               <trh:tableLayout width="98%">
                   <trh:rowLayout>
                       <trh:cellFormat inlineStyle="width:99%">
                           &#160;
                       </trh:cellFormat>
                       <trh:cellFormat inlineStyle="background-color: white; text-align:right; white-space:nowrap; "
                               rendered="#{searchBean.totalResults gt 0}">
                           Total: <b>
                   <h:outputText value="#{searchBean.totalResults}" style="background-color:white;">
                       <f:convertNumber pattern="#,###"/>
                   </h:outputText></b>
                   binary interactions
                       </trh:cellFormat>
                   </trh:rowLayout>
               </trh:tableLayout>
           </div>

           <tr:panelGroupLayout rendered="#{searchBean.totalResults == 0}">
               <div style="padding-left:10px">
                <b>No results were found for this query.</b>
               </div>
           </tr:panelGroupLayout>

           <tr:panelGroupLayout rendered="#{searchBean.totalResults gt 0}">



               <tr:panelTabbed position="above">
                   <c:forEach var="name" items="#{searchBean.activeServiceNames}">
                       <ui:include src="/pages/search/result_tab.xhtml">
                           <ui:param name="name" value="#{name}"/>
                       </ui:include>
                   </c:forEach>
               </tr:panelTabbed>

           </tr:panelGroupLayout>

            <tr:panelGroupLayout rendered="#{fn:length(searchBean.inactiveServices) gt 0}">
                <tr:separator/>

                   <div style="padding-left:10px">
                   It searches these databases: <b>#{fn:join(searchBean.activeServiceNames, ', ')}</b>

                   There are some inactive services at the moment: <b>#{fn:join(searchBean.inactiveServiceNames, ', ')}</b>. (
                   <tr:goLink text="check status" destination="http://www.ebi.ac.uk/Tools/webservices/psicquic/registry/registry?action=STATUS"
                           targetFrame="_blank"/> |&#160;<tr:commandLink text="refresh" actionListener="#{searchBean.refresh}"/>)

                   </div>

                <tr:separator/>
           </tr:panelGroupLayout>

       </tr:form>
          </div>
      </trh:body>
   </tr:document>

</ui:composition>
